<div class="my-4">
  @if (selectedMatch()) {
  <a href="#" class="text-decoration-none" (click)="closeScoresheet(); $event.preventDefault()">« Back to Match
    Results</a>
  } @else {
  <a class="text-decoration-none" href="/">« Back to Main Dashboard</a>
  }
</div>

@if (selectedMatch()) {
<app-scoresheet [match]="selectedMatch()" [alliance]="selectedAlliance()"></app-scoresheet>
} @else {

<div class="print-area" [class.condensed]="condensed" [class.print-keep-bg]="keepBackgroundOnPrint">

  <div class="header-row">
    <div class="d-flex align-items-center gap-3">
      <label class="form-check-label">
        <input class="form-check-input me-1" type="checkbox" (change)="condensed = ($any($event.target).checked)">
        Condensed
      </label>
      <label class="form-check-label">
        <input class="form-check-input me-1" type="checkbox"
          (change)="keepBackgroundOnPrint = ($any($event.target).checked)"> Keep Background on Print
      </label>
    </div>

    <button class="print-btn" title="Print" (click)="printPage()">
      <i class="bi bi-printer"></i>
    </button>
  </div>

  <h2 class="event-title my-2 text-center fw-semibold">Match Results</h2>

  @if (loading()) {
  <div class="d-flex justify-content-center my-4">
    <div class="spinner-border text-primary" role="status"></div>
  </div>
  }

  @if (error()) {
  <div class="alert alert-warning text-center">{{ error() }}</div>
  }

  @if (!loading() && !error() && matches().length) {
  <table class="results-table w-100">
    <thead>
      <tr>
        <th class="text-center">Match</th>
        <th class="text-center">Result</th>
        <th class="text-center">Red</th>
        <th class="text-center">Blue</th>
        <th class="text-center print-hide">Score breakdown</th>
      </tr>
    </thead>
    <tbody>
      @for (match of matches(); track match.match.id; let gi = $index) {

      @for (r of rows(teamRowCount(match)); track r) {
      <tr [class.group-alt]="gi % 2 === 1">
        @if (r === 0) {
        <td class="text-center" [attr.rowspan]="teamRowCount(match)">
          {{ match.match.matchCode }}
        </td>

        <td class="text-center" [attr.rowspan]="teamRowCount(match)" [class.bg-danger]="winner(match) === 'red'"
          [class.bg-primary]="winner(match) === 'blue'">
          @if (isUnplayed(match)) {
          <span class="text-muted">Unplayed</span>
          } @else {
          <span class="fw-semibold text-white print-result-text">{{ formatResult(match) }}</span>
          }
        </td>
        }

        <td class="text-center">{{ teamIdAt(match.redTeams, r) }}</td>
        <td class="text-center">{{ teamIdAt(match.blueTeams, r) }}</td>

        @if (r === 0) {
        <td class="text-center print-hide" [attr.rowspan]="teamRowCount(match)">
          <div><a href="#" class="text-decoration-none" (click)="viewScoresheet(match, $event)">Scoresheet</a></div>
          <div class="mt-1">
            <a href="#" class="text-danger text-decoration-none" (click)="viewScoresheet(match, $event, 'red')">Red</a>
            <span class="mx-2 text-muted">|</span>
            <a href="#" class="text-primary text-decoration-none"
              (click)="viewScoresheet(match, $event, 'blue')">Blue</a>
          </div>
        </td>
        }
      </tr>
      }
      }
    </tbody>
  </table>
  } @else if (!loading() && !error()) {
  <p class="text-center text-muted">No match results available.</p>
  }
</div>
}